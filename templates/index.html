{%extends "layout.html"%}

{%block header%}

  <title>Space Info</title>
  <meta name="description" content="The latest in space news, rocket launches and aerospace jobs">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href={{url_for('static',filename='css/index.css')}} rel="stylesheet" type="text/css" />

{%endblock%}


{%block nextlaunch%}
  <div class="row">
    <div class="col-xs-12">
      <h1>Next Rocket Launch: {{next}}</h1>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-4 left">
      <p class="launch-date"></p>
    </div>
    <div class="col-xs-8 left">
      <p class="t-minus"></p>
    </div>
  </div>
  <script type="text/javascript">

    var date = "{{ date }}";
    var y = new Date().getFullYear();
    date = date + " " + y;
    function formatDate(date) {
      let d = new Date(date),
          month = '' + (d.getMonth() + 1),
          day = '' + d.getDate(),
          year = d.getFullYear();
      if (month.length < 2) month = '0' + month;
      if (day.length < 2) day = '0' + day;
      return [year, month, day].join('-');
    }
    date = formatDate(date);

    var time = "{{ time }}";
    var time_utc;

    /* get just the GMT time or TBD */
    if (time != "TBD") {
      let gmt = time.indexOf("GMT");
      let dash = time.indexOf("-");
      time = time.slice(0,gmt);
      time = time.slice(0,dash);
      time = time.substr(0,2) + ":" + time.substr(2);
      if(time.length < 5){
        time = time + ":00";
      }
      time_utc = moment.utc(date + " " + time);
    }
    var offset = new Date().getTimezoneOffset();
    time_local = time_utc - offset;
    time_local_utc = moment.utc(time_utc - offset);
    time_formatted = moment(time_local).format('MMMM Do YYYY, h:mm:ss a');
    time_diff = time_local_utc.diff(moment.utc());

    setInterval(function() {
      let now = moment.utc();
      let dt = time_local_utc.diff(now);
      let delta = Math.abs(dt) / 1000;
      let countdown = "";

      // calculate (and subtract) whole days
      let days = Math.floor(delta / 86400);
      delta -= days * 86400;

      // calculate (and subtract) whole hours
      let hours = Math.floor(delta / 3600) % 24;
      delta -= hours * 3600;

      // calculate (and subtract) whole minutes
      let minutes = Math.floor(delta / 60) % 60;
      delta -= minutes * 60;

      // what's left is seconds
      let seconds = Math.floor(delta % 60);

      switch(days) {
        case 2:
          countdown += days + " days ";
          break;
        case 1:
          countdown += days + " day ";
          break;
        case 0:
          coundown = "";
          break;
      }
      if (hours > 0) {
        if (hours > 1) {
          countdown += hours + " hours ";
        } else {
          countdown += hours + " hour ";
        }
      } else {
        if (days > 0) {
          countdown += hours + " hours ";
        }
      }
      if (minutes > 0) {
        if (minutes > 1) {
          countdown += minutes + " minutes ";
        } else {
          countdown += minutes + " minute ";
        }
      } else {
        if (hours > 0) {
          countdown += minutes + " minutes ";
        }
      }
      if (seconds == 1) {
        countdown += seconds + " second ";
      } else {
        countdown += seconds + " seconds ";
      }



      $('.t-minus').html("T-MINUS: " + countdown);

    }, 1000);

    $('.launch-date').html("LAUNCHING ON " + time_formatted);

  </script>

{%endblock%}


{% block video %}

  <div class="row">
    <div class="col-xs-12">
      <iframe id="livestream" width="560" height="315" style="margin: 10px auto;" src="{{link}}" frameborder="0" allowfullscreen></iframe>
    </div>
  </div>

  <script>

    if (time_diff/1000 < 172800) {
      $('#livestream').css('display', 'block');
    }

  </script>

{%endblock%}


{%block title%}

  <h1 class="upcoming">Upcoming Launches</h1>

{%endblock%}


{%block content%}

{% for data in upcoming %}
  <div class="row launches">
    <div class="col-xs-2 left">
      <p>{{data[2]}}, 2017</p>
    </div>
    <div class="col-xs-3 left">
      <p class="next-launch">{{ data[1] }}</p>
    </div>
    <div class="col-xs-5 left">
      <p class="time-until">{{ data[0] }}</p>
    </div>
    <div class="col-xs-2 right">
      <p></p>
    </div>
  </div>

{% endfor %}

{%endblock%}


{% block spacejobs %}
  <ul id="spacex__job-list" class="job-list selected">
    {% for job in spacexjobs %}
    <li>
      <a href="http://www.spacex.com{{spacexjobs[job]}}" target="_blank">{{ job }}</a><br>
    </li>
    {% endfor %}
  </ul>

  <ul id="blueorigin__job-list" class="job-list">
    {% for job in blueoriginjobs %}
    <li>
      <a href="http://www.blueorigin.com{{blueoriginjobs[job]}}" target="_blank">{{ job }}</a><br>
    </li>
    {% endfor %}
  </ul>

  <ul id="phasefour__job-list" class="job-list">
    {% for job in phasefourjobs %}
    <li>
      <a href="{{phasefourjobs[job]}}" target="_blank">{{ job }}</a><br>
    </li>
    {% endfor %}
  </ul>

  <ul id="rocketlabs__job-list" class="job-list">
    {% for job in rocketlabsjobs %}
    <li>
      <a href="http://www.rocketlabusa.com{{rocketlabsjobs[job]}}" target="_blank">{{ job }}</a><br>
    </li>
    {% endfor %}
  </ul>

  <ul id="planetaryresources__job-list" class="job-list">
    {% for job in planetaryresourcesjobs %}
    <li>
      <a href="http://www.planetaryresources.com/careers/job-board/{{job[1]}}" target="_blank">{{ job[0] }}</a><br>
    </li>
    {% endfor %}
  </ul>

  <ul id="bigelow__job-list" class="job-list">
    {% for job in bigelowjobs %}
    <li>
      <a href="{{bigelowjobs[job]}}" target="_blank">{{ job }}</a><br>
    </li>
    {% endfor %}
  </ul>

  <script>

    $('.company-icon').on('click', function() {
      var company = $(this).attr('id');
      $('.job-list').removeClass('selected');
      $('#' + company + '__job-list').addClass('selected');

      $('.company-icon').removeClass('active');
      $(this).addClass('active');

      $('.jobs-list__bg').css('background-image', 'url(/static/images/' + company + '.png)');
      /*
      $(this).css({
        'filter': 'saturate(100%)',
        '-webkit-filter': 'saturate(100%)',
        '-moz-filter': 'saturate(100%)',
        '-ms-filter': 'saturate(100%)',
        '-o-filter': 'saturate(100%)'
      });
      */
    });

  </script>
{%endblock%}
